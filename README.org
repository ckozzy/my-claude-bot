#+TITLE: my-claude-bot
#+AUTHOR: Kelly Osborn
#+EMAIL: kelly@shadetree.biz
#+OPTIONS: toc:2 num:nil
#+STARTUP: overview

* Overview

GitHub App integration for Emacs, providing authenticated access to GitHub's API using GitHub App authentication.

** What is this?

This Emacs package allows you to interact with GitHub using a GitHub App, which provides more secure and flexible authentication than personal access tokens. It's designed to integrate GitHub functionality directly into your Emacs workflow.

* Features

- GitHub App authentication with JWT token generation
- API request framework
- Secure credential management
- Comprehensive GitHub operations:
  - *Issue Management*: Create, list, comment, and close issues
  - *Pull Request Operations*: Create, review, merge, and list PRs
  - *Repository Browsing*: List repos, search code, view files
  - *Commit Operations*: View commit history and details
  - *Workflow Automation*: Trigger workflows, check CI status

See =COMMANDS.org= for complete command reference.

* Prerequisites

- Emacs 27.1 or later
- Python 3 with packages: =PyJWT=, =cryptography=, =requests=
  - Install with: ~pip3 install PyJWT cryptography requests~
- A GitHub App (see setup instructions below)
- Access to your GitHub App's private key

* Creating Your GitHub App

1. *Go to GitHub App settings:*
   - Personal account: https://github.com/settings/apps
   - Organization: https://github.com/organizations/YOUR_ORG/settings/apps

2. *Click "New GitHub App"*

3. *Fill in the details:*
   - *Name*: =my-claude-bot= (or your preferred name)
   - *Homepage URL*: =https://github.com/ckozzy/my-claude-bot=
   - *Webhook*: Uncheck "Active" (not needed for this integration)
   - *Permissions*: Choose based on your needs
     - Repository Contents: Read (or Read/Write)
     - Repository Metadata: Read
     - Issues: Read/Write (if you want to manage issues)
     - Pull Requests: Read/Write (if you want to manage PRs)
   - *Where can this app be installed?*: "Only on this account" (for personal use)

4. *Create the app* and note your *App ID*

5. *Generate a private key:*
   - Scroll down to "Private keys"
   - Click "Generate a private key"
   - Save the downloaded =.pem= file securely (e.g., =~/.config/github-apps/my-claude-bot.pem=)
   - *Never commit this file to version control!*

6. *Install the app:*
   - Click "Install App" in the left sidebar
   - Choose your account
   - Select "All repositories" or specific repositories
   - Note the *Installation ID* from the URL (e.g., =https://github.com/settings/installations/12345678=)

* Installation

** Using straight.el

#+begin_src elisp
(straight-use-package
 '(my-claude-bot :type git :host github :repo "ckozzy/my-claude-bot"))
#+end_src

** Manual Installation

1. Clone this repository:
   #+begin_src bash
   git clone https://github.com/ckozzy/my-claude-bot.git ~/path/to/my-claude-bot
   #+end_src

2. Add to your Emacs configuration:
   #+begin_src elisp
   (add-to-list 'load-path "~/path/to/my-claude-bot")
   (require 'my-claude-bot)
   #+end_src

* Configuration

Add the following to your Emacs init file (e.g., =~/.emacs.d/init.el= or =~/.doom.d/config.el=):

#+begin_src elisp
(use-package my-claude-bot
  :custom
  (my-claude-bot-app-id "YOUR_APP_ID")
  (my-claude-bot-private-key-file "~/.config/github-apps/my-claude-bot.pem")
  (my-claude-bot-installation-id "YOUR_INSTALLATION_ID"))
#+end_src

Or without =use-package=:

#+begin_src elisp
(setq my-claude-bot-app-id "YOUR_APP_ID")
(setq my-claude-bot-private-key-file "~/.config/github-apps/my-claude-bot.pem")
(setq my-claude-bot-installation-id "YOUR_INSTALLATION_ID")
#+end_src

See =config.example.el= for a complete example.

* Usage

** Quick Start

Test your connection:
#+begin_example
M-x my-claude-bot-test-connection
#+end_example

List your accessible repositories:
#+begin_example
M-x my-claude-bot-list-repos
#+end_example

** Available Commands

The package provides 25+ interactive commands organized into categories:

- *Issue Management*: =my-claude-bot-list-issues=, =my-claude-bot-create-issue=, etc.
- *Pull Requests*: =my-claude-bot-list-prs=, =my-claude-bot-create-pr=, =my-claude-bot-merge-pr=, etc.
- *Repository Browsing*: =my-claude-bot-list-repos=, =my-claude-bot-search-code=, =my-claude-bot-get-file-contents=
- *Commits*: =my-claude-bot-list-commits=, =my-claude-bot-get-commit=
- *Workflows*: =my-claude-bot-list-workflows=, =my-claude-bot-trigger-workflow=, =my-claude-bot-check-commit-status=

For complete documentation of all commands, see =COMMANDS.org=.

* How It Works

The package uses a Python script (=github-app-token.py=) to generate JWT tokens and installation access tokens. This approach:

- Handles RS256 JWT signing using industry-standard libraries
- Automatically refreshes tokens when they expire
- Caches tokens to minimize API calls
- Works reliably across different platforms

* Development

** Project Structure

#+begin_example
my-claude-bot/
├── my-claude-bot.el      # Main package file
├── github-app-token.py   # JWT/token generation script
├── config.example.el     # Example configuration
├── COMMANDS.org          # Command reference
├── README.org            # This file
└── .gitignore            # Git ignore rules (includes .pem files)
#+end_example

** Contributing

Contributions are welcome! Areas for improvement:

- [X] Implement JWT signing (RS256) - ✓ Done with Python script
- [X] Add more GitHub API helper functions - ✓ 25+ commands implemented
- [X] Add interactive commands for common tasks - ✓ Complete
- [ ] Add tests
- [ ] Add CI/CD
- [ ] Package for MELPA
- [ ] Add org-mode integration (link to issues/PRs from org files)
- [ ] Add magit integration
- [ ] Add inline diff viewing

* Security Notes

- *Never commit your private key (=.pem= file)*
- *Never commit your App ID or Installation ID if you want to keep them private*
- Store credentials securely outside of version control
- Consider using =auth-source= for credential storage

* Resources

- [[https://docs.github.com/en/apps][GitHub Apps Documentation]]
- [[https://docs.github.com/en/rest][GitHub API Documentation]]
- [[https://docs.github.com/en/apps/creating-github-apps][Creating a GitHub App]]
- [[https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app][Authenticating as a GitHub App]]

* License

MIT License - See LICENSE file for details

* Author

Your Name - https://github.com/ckozzy
